# Netty Simulation Scaffold

This repository contains a self-contained copy of the Netty Simulation Babylon.js scene and the tooling you need to serve it locally. Everything runs on Node.js 18+ using native ES modules—no external npm dependencies required.

## Requirements

- Node.js 18 or newer

## Project Layout

```
app/          # Static Babylon.js scene (HTML/CSS/JS assets)
dev/          # Utility servers for static hosting and error logging
docs/         # Additional documentation (placeholder for future notes)
.assistant.log# Generated by the error reporter
export/       # Upload destination created by the error reporter
```

## Static Scene Server

The static server serves `app/` on <http://127.0.0.1:8080/app/index.html>.

```sh
node dev/static-server.mjs          # default port 8080
PORT=9000 node dev/static-server.mjs
```

Keep the Babylon.js CDN script tags in `app/index.html` unless you deliberately fetch local copies. If you do go offline, download the two CDN assets, place them in `app/`, and update the `<script>` tags accordingly.

## Error Reporter

The error reporter is a lightweight log collector that only uses Node core modules. It writes newline-delimited JSON records to `.assistant.log` and stores uploads under `export/`.

```sh
node dev/error-reporter.mjs         # default port 6060
PORT=7000 node dev/error-reporter.mjs
```

Supported endpoints:

- `POST /log` – append a JSON payload to the log file (server adds an ISO timestamp).
- `GET /log` – return the log contents. Adds `204 No Content` when the log is empty.
- `GET /log?session=start` – truncate/recreate `.assistant.log` and respond with `204`.
- `DELETE /log` – remove the log file.
- `POST /export?name=filename.ext` – save the raw request body to `export/filename.ext`.

You can sanity check the server with:

```sh
curl -i http://127.0.0.1:6060/log?session=start
curl -i -X POST http://127.0.0.1:6060/log \
  -H 'Content-Type: application/json' \
  --data '{"event":"demo","message":"hello world"}'
```

## Verifying the Scene

1. Start the error reporter (`node dev/error-reporter.mjs`).
2. Start the static server (`node dev/static-server.mjs`).
3. Visit <http://127.0.0.1:8080/app/index.html> and confirm the blue sphere renders.
4. Tail `.assistant.log` while interacting with the app to confirm log entries flow through.

## Next Steps

1. Commit this scaffold to kick off independent development history for the project.
2. Extend the scene and logging payloads as your simulation requirements evolve.

## Helper Scripts

- `scripts/restart-servers.sh` – convenience wrapper that runs the restart script via Bash.
- `node scripts/restart-servers.mjs` – stops previously launched servers and restarts both `dev/error-reporter.mjs` and `dev/static-server.mjs`, tracking process IDs in `.server-pids.json`.
